## MPP

### MPP简介

MPP (Massively Parallel Processing)，即**大规模并行处理**。MPP 是将任务并行的分散到多个节点上，算完后汇总，与 Hadoop 相似。

MPP 数据库是一款 Shared Nothing 架构的分布式并行结构化数据库集群，可以为超大规模数据管理提供高性价比的通用计算平台，并广泛地用于支撑各类数据仓库系统、BI 系统和决策支持系统。常用的 MPP 数据库有 GreenPlum、Vertica、Sybase IQ、TD Aster Data 等。一般来说倾向于 GreenPlum，如阿里的云数据库 HybirdDB 也是基于 GreenPlum。

**MPP 数据库有对 SQL 的完整兼容和一些事务的处理能力**，对于用户来说，在实际的使用场景中，如果数据扩展需求不是特别大，需要的处理节点不多，数据都是结构化的数据，习惯使用传统的 RDBMS 的很多特性的场景，可以考虑 MPP, 例如 Greenplum/Gbase 等。



### MPPDB、Hadoop 与传统数据库技术对比

| 特征               | Hadoop                     | MPP DB   | RDBMS  |
| ------------------ | -------------------------- | -------- | ------ |
| 扩展能力           | 高                         | 高       | 低     |
| 系统和数据管理成本 | 高                         | 中       | 中     |
| 应用开发维护成本   | 高                         | 中       | 中     |
| SQL支持            | 中                         | 高       | 高     |
| 数据规模           | PB级别                     | 准PB级别 | TB级别 |
| 数据结构           | 结构化、半结构化和非结构化 | 结构化   | 结构化 |



## Doris

### Doris的历史

百度的主要收入来源是广告，所以要给广告主分析报表。

一开始是使用MySQL sharding，但是随着流量的增长，MySQL sharding顶不住了：

- 多写场景下MySQL读性能下降严重，还有锁表问题

- MySQL在大查询方面性能很差，所以只能产品层面限制用户的查询时间范围
- MySQL的scalability很差，大的单表查询很慢，拆表拆库、数据迁移会导致无法维护

当时没有成熟的数据存储和计算的开源产品，而Hbase导入性能只有大约2000条/秒，顶不住，从而在2008年诞生了Doris1。

### Doris作用

Apache Doris 是一个现代化的 MPP 分析型数据库产品，仅需亚秒级响应时间即可获得查询结果，有效地支持实时数据分析。Apache Doris 的分布式架构非常简洁，易于运维，并且可以支持 10PB 以上的超大数据集。如果高于 PB 级别，不推荐使用 Doris 解决，可以考虑用 Hive 等工具。

Apache Doris 可以满足多种数据分析需求，例如固定历史报表，实时数据分析，交互式数据分析和探索式数据分析等。

### Doris 整体架构

<img  src="http://doris.incubator.apache.org/master/images/palo_architecture.jpg" width=500) >

Doris 的整体架构和 TiDB 类似，借助 MySQL 协议，用户使用任意 MySQL 的 ODBC/JDBC 以及 MySQL 的客户端，都可以直接访问 Doris。

Doris 中的模块包括 FE 和 BE 两类：FE 主要负责**元数据的管理、存储**，以及查询的解析等；一个用户请求经过 FE 解析、规划后，具体的执行计划会发送给 BE，BE 则会完成查询的具体执行。BE 节点主要负责数据的存储、以及查询计划的执行。

### Doris 数据分布

一张 Table 会拆成多个 Tablet，Tablet 会存成多副本，存储在不同的 BE 中，从而保证数据的高可用和高可靠。Doris 内部自行管理数据的多副本和自动修复。保证数据的高可用、高可靠。在服务器宕机的情况下，服务依然可用，数据也不会丢失。

<img src="https://upload-images.jianshu.io/upload_images/16177192-f1092a7bb4869764?imageMogr2/auto-orient/strip|imageView2/2/w/681/format/webp" width=600>

### Doris 数据模型

所有数据分成两列：Key 列和 Value 列。如下图所示，Time、Id、Country 列共同组成 Key 列，Clicks、Cost 列为 Value 列。

Doris 的数据是按列存储的。

物化视图是提取某些维度的组合建立对用户透明的却有真实数据的视图表格。Doris 的物化视图可以保证用户在更新时，直接更新原始表，Doris 会保证原表、物化视图原子生效。Doris 会根据用户的查询选择适合的物化视图。

<img src="https://upload-images.jianshu.io/upload_images/16177192-b02944bf1592fd63?imageMogr2/auto-orient/strip|imageView2/2/w/926/format/webp" width=600>

**Doris 其他特性**

- 原子性 —— 即一批数据要么都生效，要么都不生效。
- 支持单机多盘
- 向量化执行
-  UDF (User Defined Function 用户自定义函数)
-  内置 HLL 类型，快速计算 UV



## Reference

- Doris简史-为分析而生的11年 - 老王的文章 - 知乎 https://zhuanlan.zhihu.com/p/66637804
- 5分钟了解MPP数据库 - Bumblebee灬的文章 - 知乎 https://zhuanlan.zhihu.com/p/148621151
- https://www.jianshu.com/p/d3742af8ecce
  



















































