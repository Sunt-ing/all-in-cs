### 缓存的使用

#### 使用缓存的场景

用缓存主要是看重了缓存的高性能和高并发。比如，你一个请求过来，使用MySQL查询，耗时**600ms**终于出结果了。而且MySQL并不天然支持高并发，一般可能QPS到**2000**时就开始报警了。

那么假如这个结果接下来的几个小时都基本不变，那么把这个结果丢缓存里就是一个很好的方法。下次这个请求再来的时候，就可以直接从缓存中获取了，耗时**2ms**。毕竟缓存天然支持高并发，比如Redis的QPS可达**十几万**。

#### 不宜使用缓存的场景

- 内存资源宝贵
- 缓存命中率低
- 多写场景

#### 使用缓存带来的问题

- 缓存和数据库不一致
- 缓存雪崩、缓存穿透、缓存击穿
- 缓存并发竞争

### Redis 和 Memcached 有啥区别？

- Redis有更多的数据结构和操作
- Redis原生支持集群模式
- Redis只能使用单核，Memcached能使用多核。

### Redis的线程模型

#### 一般是单线程

Redis采用单线程的file event handler（文件事件处理器），使用Epoll监听各个socket连接。

之所以单线程效率还是很高，是因为：

- 纯内存
- 基于Epoll
- C语言实现
- CPU 不是 Redis 的瓶颈
- 单线程避免了上下文切换、线程竞争

#### Redis6.0开始引进多线程

多线程主要是用来处理网络数据的读写和协议解析，因为网络IO占了大部分的CPU时间。执行命令还是单线程。

官方建议，设置的线程数不要超过CPU的核数，4核的设成2、3个，8核的设成6个。

### Redis的数据结构

String、Hash、List、Set、Sorted Set，以及其他的高级数据结构。



